"use strict";(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[569],{9079:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var a=s(3396),n=s(7139);const o={class:"card border-secondary mb-3"},i={class:"card-header"},d={class:"float-start"},l={class:"float-end"},r={class:"btn-group"},c={class:"card-body"},v={class:"card-title"},h={class:"card-text"},b=["innerHTML"],u={class:"card border-secondary mb-3"},g=(0,a._)("div",{class:"card-header"},"History",-1),p={class:"card-body"};function _(e,t,s,_,y,f){const m=(0,a.up)("job-event-box");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",o,[(0,a._)("div",i,[(0,a._)("h2",d," Job - "+(0,n.zw)(y.job.id),1),(0,a._)("div",l,[(0,a._)("div",r,[(0,a._)("button",{class:"btn btn-outline-primary",onClick:t[0]||(t[0]=e=>f.requeue())},"Requeue"),(0,a._)("button",{class:"btn btn-outline-danger",onClick:t[1]||(t[1]=e=>f.deleteJob())},"Delete")])])]),(0,a._)("div",c,[(0,a._)("h4",v,(0,n.zw)(y.job.type),1),(0,a._)("p",h,[(0,a._)("pre",{innerHTML:JSON.stringify(y.payload,null,2)},null,8,b)])])]),(0,a._)("div",u,[g,(0,a._)("div",p,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(y.events,(e=>((0,a.wg)(),(0,a.j4)(m,{key:e.id,event:e},null,8,["event"])))),128))])])])}var y=s(8332);const f=e=>((0,a.dD)("data-v-653b88e2"),e=e(),(0,a.Cn)(),e),m={class:"summary"},j={class:"float-end"},w={key:0,class:"text-center"},k=f((()=>(0,a._)("div",{class:"spinner-border",role:"status"},[(0,a._)("span",{class:"visually-hidden"},"Loading...")],-1))),D=[k],J={key:1},C={style:{"padding-right":"20px","vertical-align":"top"}},E=["innerHTML"],L={key:2},x=f((()=>(0,a._)("small",null,"No logs to display",-1))),T=[x];function H(e,t,s,o,i,d){return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["event-box",{active:i.active,[`event-type-${s.event.type.toLowerCase()}`]:!0}])},[(0,a._)("div",{class:"event-box-header",onClick:t[0]||(t[0]=e=>d.toggleActive())},[(0,a._)("div",m,[(0,a.Uk)((0,n.zw)(i.eventTitles[s.event.type]||"Unknown")+" ",1),(0,a._)("span",j,(0,n.zw)(s.event.created_at),1)])]),(0,a._)("div",{class:(0,n.C_)(["collapse event-box-content",{show:i.active}])},[i.loading?((0,a.wg)(),(0,a.iD)("div",w,D)):i.logs.length>0?((0,a.wg)(),(0,a.iD)("table",J,[(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.logs,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",C,[(0,a._)("pre",null,(0,n.zw)(e.created_at),1)]),(0,a._)("td",null,[(0,a._)("code",{innerHTML:e.message},null,8,E)])])))),128))])])):((0,a.wg)(),(0,a.iD)("i",L,T))],2)],2)}var S={name:"JobEventBox",props:{event:{type:Object}},data(){return{active:!1,logs:[],loading:!1,eventTitles:{SCHEDULED:"Job scheduled",ENQUEUED:"Job enqueued",PROCESSING:"Processing job",FAILED:"Job processing failed",SUCCESS:"Job processing succeeded"}}},methods:{toggleActive(){this.active=!this.active,this.active?this.fetchLogs():this.logs=[]},fetchLogs(){this.loading=!0,y.Z.get("/jobs/"+this.event.job_id+"/events/"+this.event.id+"/logs").then((e=>{this.logs=e.data.data,this.loading=!1}))}}},U=s(89);const Z=(0,U.Z)(S,[["render",H],["__scopeId","data-v-653b88e2"]]);var z=Z,I={name:"Job",components:{JobEventBox:z},data(){return{job:{id:this.$route.params.id,type:""},payload:{},events:[],refreshTimer:void 0}},created(){this.fetchJob(!0),this.fetchEvents(),this.refreshTimer=setInterval(this.fetchJob,3e3)},beforeUnmount(){clearInterval(this.refreshTimer)},methods:{fetchJob(e=!1){y.Z.get("/jobs/"+this.job.id,{params:{payload:!0}}).then((t=>{this.job.status!==t.data.data.status&&this.fetchEvents(),e&&(this.payload=t.data.data.payload),this.job=t.data.data}),(()=>{this.$router.push({name:"jobs"})}))},deleteJob(){y.Z["delete"]("/jobs/"+this.job.id).then((()=>{this.$router.push({name:"jobs"})}))},requeue(){},fetchEvents(){y.Z.get("/jobs/"+this.job.id+"/events").then((e=>this.events=e.data.data))}}};const q=(0,U.Z)(I,[["render",_]]);var M=q}}]);
//# sourceMappingURL=job.fe497f05.js.map