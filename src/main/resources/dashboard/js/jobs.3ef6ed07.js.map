{"version":3,"file":"js/jobs.3ef6ed07.js","mappings":"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","sources":["webpack://dashboard/./src/views/jobs/Jobs.vue","webpack://dashboard/./src/components/JobCreator.vue","webpack://dashboard/./src/components/JobCreator.vue?e0b9","webpack://dashboard/./src/views/jobs/Jobs.vue?ffc9"],"sourcesContent":["<template>\n  <div>\n    <h2>Jobs</h2>\n    <bs-tab :tabs=\"Object.keys(statuses).map(k => ({ key: k, text: statuses[k] }))\" v-model=\"tab\">\n      <template v-slot:[`item`]=\"{ item }\">\n        <i class=\"bi\" :class=\"{ ['bi-' + jobIcons[item.key]]: true }\" style=\"margin-right: 10px;\"></i>\n        {{ item.text }}\n        <span class=\"badge rounded-pill\" :class=\"{ [item.key === tab ? 'text-bg-primary' : 'text-bg-dark']: true }\" style=\"margin-left: 10px;\">{{ jobCounts[item.key] }}</span>\n      </template>\n    </bs-tab>\n    <div v-for=\"status in Object.keys(statuses)\" :key=\"status\" :style=\"{ display: status === tab ? 'block' : 'none' }\">\n      <bs-table :headers=\"[\n        { key: 'bulk', text: '' },\n        { key: 'id', text: 'ID' },\n        { key: 'type', text: 'Type' },\n        { key: 'created_at', text: 'Created At' }\n    ]\" :items=\"jobs\">\n        <template v-slot:[`header.bulk`]>\n          <input type=\"checkbox\" class=\"form-check\" v-model=\"checkAll\" @input=\"e => toggleCheckAll(e.target.checked)\">\n        </template>\n        <template v-slot:[`item.bulk`]=\"{ item }\">\n          <input type=\"checkbox\" class=\"form-check\" v-model=\"checked[item.id]\" @input=\"e => toggleChecked(item.id, e.target.checked)\">\n        </template>\n        <template v-slot:[`item.id`]=\"{ item }\">\n          <router-link :to=\"{ name: 'job', params: { id: item.id } }\">{{ item.id }}</router-link>\n        </template>\n      </bs-table>\n    </div>\n    <job-creator ref=\"jobCreator\" @created=\"this.fetchJobCounts()\" />\n    <button class=\"btn btn-primary\" @click=\"$refs.jobCreator.show()\">Create Job</button>\n  </div>\n</template>\n\n<script>\nimport BsTable from \"@/components/BSTable\";\nimport api from \"@/api\";\nimport BsTab from \"@/components/BSTab\";\nimport JobCreator from \"@/components/JobCreator\";\n\nexport default {\n  name: \"Jobs\",\n  data() {\n    return {\n      statuses: {\n        'SCHEDULED': 'Scheduled',\n        'ENQUEUED': 'Enqueued',\n        'PROCESSING': 'Processing',\n        'SUCCESS': 'Succeeded',\n        'FAILED': 'Failed'\n      },\n      tab: 'SCHEDULED',\n      jobs: [],\n      jobCounts: {\n        SCHEDULED: 0,\n        ENQUEUED: 0,\n        PROCESSING: 0,\n        SUCCESS: 0,\n        FAILED: 0\n      },\n      jobIcons: {\n        SCHEDULED: 'clock',\n        ENQUEUED: 'hourglass',\n        PROCESSING: 'gear',\n        SUCCESS: 'check-circle',\n        FAILED: 'exclamation-circle'\n      },\n      checkAll: false,\n      checked: {},\n      countTimer: undefined\n    }\n  },\n  created() {\n    this.fetchJobs()\n    this.fetchJobCounts()\n    this.countTimer = setInterval(this.fetchJobCounts, 3000)\n  },\n  beforeUnmount() {\n    clearInterval(this.countTimer)\n  },\n  watch: {\n    tab() {\n      this.fetchJobs()\n    }\n  },\n  methods: {\n    spawnJob(queue, schedule_at, type, payload) {\n      api.post('/jobs', {\n        queue,\n        schedule_at: schedule_at || undefined,\n        type,\n        payload\n      }).then(() => {\n        this.fetchJobs()\n        this.fetchJobCounts()\n      })\n    },\n    fetchJobs() {\n      this.jobs = []\n      api.get('/jobs', { params: { status: this.tab } }).then(res => {\n        this.checkAll = false\n        this.checked = {}\n        this.jobs = res.data.data\n      })\n    },\n    fetchJobCounts() {\n      api.get('/status/job-counts').then(res => {\n        if(this.jobCounts[this.tab] !== res.data.data[this.tab]) {\n          this.fetchJobs();\n        }\n        this.jobCounts = res.data.data\n      })\n    },\n    toggleChecked(id, value) {\n      this.checked[id] = value\n      this.checkAll = this.jobs.reduce((c, v) => c && this.checked[v.id], true)\n    },\n    toggleCheckAll(value) {\n      if(value) {\n        this.checkAll = true\n        this.jobs.forEach(j => this.checked[j.id] = true)\n      } else {\n        this.checkAll = false\n        this.checked = {}\n      }\n    }\n  },\n  components: {JobCreator, BsTab, BsTable}\n}\n</script>\n\n<style scoped>\n\n</style>","<template>\n  <div>\n    <bs-modal v-model=\"open\" @cancel=\"resetForm()\" @ok=\"createJob()\" title=\"Create Job\" size=\"lg\" ok-text=\"Create\">\n      <bs-select v-model=\"queue\" :options=\"queues\">Queue</bs-select>\n      <bs-select v-model=\"type\" :options=\"types\" class=\"mt-2\">Type</bs-select>\n      <div class=\"form-group mt-2\">\n        <label class=\"form-label\">Payload</label>\n        <textarea class=\"form-control\" v-model=\"payload\" rows=\"7\" />\n      </div>\n    </bs-modal>\n  </div>\n</template>\n\n<script>\nimport api from \"@/api\";\n\nexport default {\n  name: \"JobCreator\",\n  data() {\n    return {\n      open: false,\n      types: [],\n      queues: [],\n      queue: '',\n      type: '',\n      payload: '{}'\n    }\n  },\n  created() {\n    this.fetchTypesAndQueues();\n  },\n  methods: {\n    fetchTypesAndQueues() {\n      api.get('/status/job-types').then(res => this.types = res.data.data)\n      api.get('/workers').then(res => {\n        this.queues = res.data.data.reduce((c, v) => {\n          if(!c.includes(v.queue))\n            c.push(v.queue)\n          return c\n        }, [])\n      })\n    },\n    show() {\n      this.open = true\n    },\n    resetForm() {\n      this.queue = ''\n      this.type = ''\n      this.payload = ''\n    },\n    createJob() {\n      api.post('/jobs', {\n        queue: this.queue,\n        type: this.type,\n        payload: JSON.parse(this.payload)\n      }).then(res => this.$emit('created', res.data.data))\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>","import { render } from \"./JobCreator.vue?vue&type=template&id=044f83bb\"\nimport script from \"./JobCreator.vue?vue&type=script&lang=js\"\nexport * from \"./JobCreator.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/user/dev/java/jobs/dashboard/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Jobs.vue?vue&type=template&id=39b9b20e\"\nimport script from \"./Jobs.vue?vue&type=script&lang=js\"\nexport * from \"./Jobs.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/user/dev/java/jobs/dashboard/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","_createElementBlock","_hoisted_1","_createVNode","_component_bs_tab","tabs","Object","keys","$data","map","k","key","text","$event","_withCtx","item","class","style","_toDisplayString","_Fragment","_renderList","status","display","_component_bs_table","headers","items","type","onInput","e","$options","target","checked","id","_component_router_link","to","name","params","_component_job_creator","ref","onCreated","fetchJobCounts","onClick","_ctx","jobCreator","show","_component_bs_modal","onCancel","onOk","title","size","_component_bs_select","options","_hoisted_4","rows","data","open","types","queues","queue","payload","created","this","fetchTypesAndQueues","methods","api","then","res","reduce","c","v","includes","push","resetForm","createJob","JSON","parse","$emit","__exports__","statuses","tab","jobs","jobCounts","SCHEDULED","ENQUEUED","PROCESSING","SUCCESS","FAILED","jobIcons","checkAll","countTimer","undefined","fetchJobs","setInterval","beforeUnmount","clearInterval","watch","spawnJob","schedule_at","toggleChecked","value","toggleCheckAll","forEach","j","components","JobCreator","BsTab","BsTable","render"],"sourceRoot":""}