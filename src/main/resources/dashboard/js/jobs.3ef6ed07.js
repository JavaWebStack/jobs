"use strict";(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[18],{813:function(e,t,s){s.r(t),s.d(t,{default:function(){return U}});var a=s(3396),o=s(7139),l=s(9242);const u=(0,a._)("h2",null,"Jobs",-1),c=["onUpdate:modelValue","onInput"];function d(e,t,s,d,n,h){const i=(0,a.up)("bs-tab"),r=(0,a.up)("router-link"),b=(0,a.up)("bs-table"),p=(0,a.up)("job-creator");return(0,a.wg)(),(0,a.iD)("div",null,[u,(0,a.Wm)(i,{tabs:Object.keys(n.statuses).map((e=>({key:e,text:n.statuses[e]}))),modelValue:n.tab,"onUpdate:modelValue":t[0]||(t[0]=e=>n.tab=e)},{["item"]:(0,a.w5)((({item:e})=>[(0,a._)("i",{class:(0,o.C_)(["bi",{["bi-"+n.jobIcons[e.key]]:!0}]),style:{"margin-right":"10px"}},null,2),(0,a.Uk)(" "+(0,o.zw)(e.text)+" ",1),(0,a._)("span",{class:(0,o.C_)(["badge rounded-pill",{[e.key===n.tab?"text-bg-primary":"text-bg-dark"]:!0}]),style:{"margin-left":"10px"}},(0,o.zw)(n.jobCounts[e.key]),3)])),_:2},1032,["tabs","modelValue"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(n.statuses),(e=>((0,a.wg)(),(0,a.iD)("div",{key:e,style:(0,o.j5)({display:e===n.tab?"block":"none"})},[(0,a.Wm)(b,{headers:[{key:"bulk",text:""},{key:"id",text:"ID"},{key:"type",text:"Type"},{key:"created_at",text:"Created At"}],items:n.jobs},{["header.bulk"]:(0,a.w5)((()=>[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"form-check","onUpdate:modelValue":t[1]||(t[1]=e=>n.checkAll=e),onInput:t[2]||(t[2]=e=>h.toggleCheckAll(e.target.checked))},null,544),[[l.e8,n.checkAll]])])),["item.bulk"]:(0,a.w5)((({item:e})=>[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"form-check","onUpdate:modelValue":t=>n.checked[e.id]=t,onInput:t=>h.toggleChecked(e.id,t.target.checked)},null,40,c),[[l.e8,n.checked[e.id]]])])),["item.id"]:(0,a.w5)((({item:e})=>[(0,a.Wm)(r,{to:{name:"job",params:{id:e.id}}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.id),1)])),_:2},1032,["to"])])),_:2},1032,["items"])],4)))),128)),(0,a.Wm)(p,{ref:"jobCreator",onCreated:t[3]||(t[3]=e=>this.fetchJobCounts())},null,512),(0,a._)("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=t=>e.$refs.jobCreator.show())},"Create Job")])}var n=s(9082),h=s(8332),i=s(1179);const r=(0,a.Uk)("Queue"),b=(0,a.Uk)("Type"),p={class:"form-group mt-2"},m=(0,a._)("label",{class:"form-label"},"Payload",-1);function k(e,t,s,o,u,c){const d=(0,a.up)("bs-select"),n=(0,a.up)("bs-modal");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(n,{modelValue:u.open,"onUpdate:modelValue":t[3]||(t[3]=e=>u.open=e),onCancel:t[4]||(t[4]=e=>c.resetForm()),onOk:t[5]||(t[5]=e=>c.createJob()),title:"Create Job",size:"lg","ok-text":"Create"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{modelValue:u.queue,"onUpdate:modelValue":t[0]||(t[0]=e=>u.queue=e),options:u.queues},{default:(0,a.w5)((()=>[r])),_:1},8,["modelValue","options"]),(0,a.Wm)(d,{modelValue:u.type,"onUpdate:modelValue":t[1]||(t[1]=e=>u.type=e),options:u.types,class:"mt-2"},{default:(0,a.w5)((()=>[b])),_:1},8,["modelValue","options"]),(0,a._)("div",p,[m,(0,a.wy)((0,a._)("textarea",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>u.payload=e),rows:"7"},null,512),[[l.nr,u.payload]])])])),_:1},8,["modelValue"])])}var y={name:"JobCreator",data(){return{open:!1,types:[],queues:[],queue:"",type:"",payload:"{}"}},created(){this.fetchTypesAndQueues()},methods:{fetchTypesAndQueues(){h.Z.get("/status/job-types").then((e=>this.types=e.data.data)),h.Z.get("/workers").then((e=>{this.queues=e.data.data.reduce(((e,t)=>(e.includes(t.queue)||e.push(t.queue),e)),[])}))},show(){this.open=!0},resetForm(){this.queue="",this.type="",this.payload=""},createJob(){h.Z.post("/jobs",{queue:this.queue,type:this.type,payload:JSON.parse(this.payload)}).then((e=>this.$emit("created",e.data.data)))}}},C=s(89);const f=(0,C.Z)(y,[["render",k]]);var g=f,E={name:"Jobs",data(){return{statuses:{SCHEDULED:"Scheduled",ENQUEUED:"Enqueued",PROCESSING:"Processing",SUCCESS:"Succeeded",FAILED:"Failed"},tab:"SCHEDULED",jobs:[],jobCounts:{SCHEDULED:0,ENQUEUED:0,PROCESSING:0,SUCCESS:0,FAILED:0},jobIcons:{SCHEDULED:"clock",ENQUEUED:"hourglass",PROCESSING:"gear",SUCCESS:"check-circle",FAILED:"exclamation-circle"},checkAll:!1,checked:{},countTimer:void 0}},created(){this.fetchJobs(),this.fetchJobCounts(),this.countTimer=setInterval(this.fetchJobCounts,3e3)},beforeUnmount(){clearInterval(this.countTimer)},watch:{tab(){this.fetchJobs()}},methods:{spawnJob(e,t,s,a){h.Z.post("/jobs",{queue:e,schedule_at:t||void 0,type:s,payload:a}).then((()=>{this.fetchJobs(),this.fetchJobCounts()}))},fetchJobs(){this.jobs=[],h.Z.get("/jobs",{params:{status:this.tab}}).then((e=>{this.checkAll=!1,this.checked={},this.jobs=e.data.data}))},fetchJobCounts(){h.Z.get("/status/job-counts").then((e=>{this.jobCounts[this.tab]!==e.data.data[this.tab]&&this.fetchJobs(),this.jobCounts=e.data.data}))},toggleChecked(e,t){this.checked[e]=t,this.checkAll=this.jobs.reduce(((e,t)=>e&&this.checked[t.id]),!0)},toggleCheckAll(e){e?(this.checkAll=!0,this.jobs.forEach((e=>this.checked[e.id]=!0))):(this.checkAll=!1,this.checked={})}},components:{JobCreator:g,BsTab:i.Z,BsTable:n.Z}};const w=(0,C.Z)(E,[["render",d]]);var U=w}}]);
//# sourceMappingURL=jobs.3ef6ed07.js.map