"use strict";(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[18],{7728:function(e,t,s){s.r(t),s.d(t,{default:function(){return Z}});var a=s(3396),o=s(7139),l=s(9242);const u=(0,a._)("h2",null,"Jobs",-1),c=["onUpdate:modelValue","onInput"],d={class:"float-end"},i={class:"pagination"},n={class:"page-item"},h=(0,a._)("span",{"aria-hidden":"true"},"«",-1),r=[h],p={class:"page-item"},b={class:"page-link"},m={class:"page-item"},k=(0,a._)("span",{"aria-hidden":"true"},"»",-1),y=[k];function g(e,t,s,h,k,g){const C=(0,a.up)("bs-tab"),f=(0,a.up)("router-link"),E=(0,a.up)("bs-table"),U=(0,a.up)("job-creator");return(0,a.wg)(),(0,a.iD)("div",null,[u,(0,a.Wm)(C,{tabs:Object.keys(k.statuses).map((e=>({key:e,text:k.statuses[e]}))),modelValue:k.tab,"onUpdate:modelValue":t[0]||(t[0]=e=>k.tab=e)},{["item"]:(0,a.w5)((({item:e})=>[(0,a._)("i",{class:(0,o.C_)(["bi",{["bi-"+k.jobIcons[e.key]]:!0}]),style:{"margin-right":"10px"}},null,2),(0,a.Uk)(" "+(0,o.zw)(e.text)+" ",1),(0,a._)("span",{class:(0,o.C_)(["badge rounded-pill",{[e.key===k.tab?"text-bg-primary":"text-bg-dark"]:!0}]),style:{"margin-left":"10px"}},(0,o.zw)(k.jobCounts[e.key]),3)])),_:2},1032,["tabs","modelValue"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(k.statuses),(e=>((0,a.wg)(),(0,a.iD)("div",{key:e,style:(0,o.j5)({display:e===k.tab?"block":"none"})},[(0,a.Wm)(E,{headers:[{key:"bulk",text:""},{key:"id",text:"ID"},{key:"type",text:"Type"},{key:"created_at",text:"Created At"}],items:k.jobs},{["header.bulk"]:(0,a.w5)((()=>[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"form-check","onUpdate:modelValue":t[1]||(t[1]=e=>k.checkAll=e),onInput:t[2]||(t[2]=e=>g.toggleCheckAll(e.target.checked))},null,544),[[l.e8,k.checkAll]])])),["item.bulk"]:(0,a.w5)((({item:e})=>[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"form-check","onUpdate:modelValue":t=>k.checked[e.id]=t,onInput:t=>g.toggleChecked(e.id,t.target.checked)},null,40,c),[[l.e8,k.checked[e.id]]])])),["item.id"]:(0,a.w5)((({item:e})=>[(0,a.Wm)(f,{to:{name:"job",params:{id:e.id}}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.id),1)])),_:2},1032,["to"])])),_:2},1032,["items"])],4)))),128)),(0,a.Wm)(U,{ref:"jobCreator",onCreated:t[3]||(t[3]=e=>this.fetchJobCounts()),scheduled:"SCHEDULED"===k.tab},null,8,["scheduled"]),["ENQUEUED","SCHEDULED"].includes(k.tab)?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"btn btn-primary",onClick:t[4]||(t[4]=t=>e.$refs.jobCreator.show())},"Create Job")):(0,a.kq)("",!0),(0,a._)("div",d,[(0,a._)("nav",null,[(0,a._)("ul",i,[(0,a._)("li",n,[(0,a._)("a",{class:"page-link",onClick:t[5]||(t[5]=e=>g.prevPage()),style:{cursor:"pointer","user-select":"none"}},r)]),(0,a._)("li",p,[(0,a._)("a",b,(0,o.zw)(k.page),1)]),(0,a._)("li",m,[(0,a._)("a",{class:"page-link",onClick:t[6]||(t[6]=e=>g.nextPage()),style:{cursor:"pointer","user-select":"none"}},y)])])])])])}var C=s(9082),f=s(8332),E=s(1179);const U=(0,a.Uk)("Queue"),w=(0,a.Uk)("Type"),_=(0,a.Uk)("Schedule At"),D={class:"form-group mt-2"},j=(0,a._)("label",{class:"form-label"},"Payload",-1);function S(e,t,s,o,u,c){const d=(0,a.up)("bs-select"),i=(0,a.up)("bs-input"),n=(0,a.up)("bs-modal");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(n,{modelValue:u.open,"onUpdate:modelValue":t[4]||(t[4]=e=>u.open=e),onCancel:t[5]||(t[5]=e=>c.resetForm()),onOk:t[6]||(t[6]=e=>c.createJob()),title:"Create Job",size:"lg","ok-text":"Create"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{modelValue:u.queue,"onUpdate:modelValue":t[0]||(t[0]=e=>u.queue=e),options:u.queues},{default:(0,a.w5)((()=>[U])),_:1},8,["modelValue","options"]),(0,a.Wm)(d,{modelValue:u.type,"onUpdate:modelValue":t[1]||(t[1]=e=>u.type=e),options:u.types,class:"mt-2"},{default:(0,a.w5)((()=>[w])),_:1},8,["modelValue","options"]),s.scheduled?((0,a.wg)(),(0,a.j4)(i,{key:0,type:"datetime-local",modelValue:u.scheduleAt,"onUpdate:modelValue":t[2]||(t[2]=e=>u.scheduleAt=e),class:"mt-2"},{default:(0,a.w5)((()=>[_])),_:1},8,["modelValue"])):(0,a.kq)("",!0),(0,a._)("div",D,[j,(0,a.wy)((0,a._)("textarea",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>u.payload=e),rows:"7"},null,512),[[l.nr,u.payload]])])])),_:1},8,["modelValue"])])}var A=s(8817),J={name:"JobCreator",components:{BsInput:A.Z},data(){return{open:!1,types:[],queues:[],queue:"",type:"",scheduleAt:"",payload:"{}"}},props:{scheduled:{type:Boolean,default:!1}},created(){this.fetchTypesAndQueues()},watch:{scheduleAt(e){console.log(e)}},methods:{fetchTypesAndQueues(){f.Z.get("/status/job-types").then((e=>this.types=e.data.data)),f.Z.get("/workers").then((e=>{this.queues=e.data.data.reduce(((e,t)=>(e.includes(t.queue)||e.push(t.queue),e)),[])}))},show(){this.open=!0},resetForm(){this.queue="",this.type="",this.scheduleAt="",this.payload=""},formatDate(e){return e.replace("T"," ")+":00"},createJob(){f.Z.post("/jobs",{queue:this.queue,type:this.type,schedule_at:this.scheduled?this.formatDate(this.scheduleAt):void 0,payload:JSON.parse(this.payload)}).then((e=>this.$emit("created",e.data.data)))}}},V=s(89);const v=(0,V.Z)(J,[["render",S]]);var q=v,x={name:"Jobs",data(){return{statuses:{SCHEDULED:"Scheduled",ENQUEUED:"Enqueued",PROCESSING:"Processing",SUCCESS:"Succeeded",FAILED:"Failed"},tab:this.$route.query.status||"SCHEDULED",jobs:[],jobCounts:{SCHEDULED:0,ENQUEUED:0,PROCESSING:0,SUCCESS:0,FAILED:0},jobIcons:{SCHEDULED:"clock",ENQUEUED:"hourglass",PROCESSING:"gear",SUCCESS:"check-circle",FAILED:"exclamation-circle"},page:1,checkAll:!1,checked:{},countTimer:void 0}},created(){this.fetchJobs(),this.fetchJobCounts(),this.countTimer=setInterval(this.fetchJobCounts,3e3)},beforeUnmount(){clearInterval(this.countTimer)},watch:{tab(){this.page=1,this.fetchJobs(),this.$router.replace({query:{status:this.tab}})}},methods:{spawnJob(e,t,s,a){f.Z.post("/jobs",{queue:e,schedule_at:t||void 0,type:s,payload:a}).then((()=>{this.fetchJobs(),this.fetchJobCounts()}))},nextPage(){this.page++,this.fetchJobs()},prevPage(){1!==this.page&&(this.page--,this.fetchJobs())},fetchJobs(){this.jobs=[],f.Z.get("/jobs",{params:{status:this.tab,page:this.page}}).then((e=>{this.checkAll=!1,this.checked={},this.jobs=e.data.data}))},fetchJobCounts(){f.Z.get("/status/job-counts").then((e=>{this.jobCounts[this.tab]!==e.data.data[this.tab]&&this.fetchJobs(),this.jobCounts=e.data.data}))},toggleChecked(e,t){this.checked[e]=t,this.checkAll=this.jobs.reduce(((e,t)=>e&&this.checked[t.id]),!0)},toggleCheckAll(e){e?(this.checkAll=!0,this.jobs.forEach((e=>this.checked[e.id]=!0))):(this.checkAll=!1,this.checked={})}},components:{JobCreator:q,BsTab:E.Z,BsTable:C.Z}};const I=(0,V.Z)(x,[["render",g]]);var Z=I}}]);
//# sourceMappingURL=jobs.96414496.js.map